<div class="gpn-container">
  <form id="gpnForm" class="gpn-form">
    <div class="form-columns">
      <div class="form-column">
        <h2>Основные параметры</h2>
        
        <div class="form-group compact">
          <label for="well_number">Номер скважины</label>
          <input type="text" id="well_number" required value="529Н">
        </div>
        
        <div class="form-group compact">
          <label for="kill_date">Дата глушения</label>
          <input type="date" id="kill_date" required value="2025-07-21">
        </div>
        
        <div class="form-group compact">
          <label for="pressure">Пластовое давление (ат)</label>
          <input type="number" step="0.1" id="pressure" required value="72">
        </div>
        
        <div class="form-group compact">
          <label for="gas_factor">Газовый фактор (м³/т)</label>
          <input type="number" step="0.1" id="gas_factor" required value="326">
        </div>
        
        <div class="form-group compact">
          <label for="depth">Глубина кровли по вертикали (м)</label>
          <input type="number" step="0.1" id="depth" required value="1855">
        </div>
        
        <div class="form-group compact">
          <label for="density">Расчетная плотность (г/см³)</label>
          <input type="number" step="0.1" id="density" required value="1">
        </div>
        
        <div class="form-group compact">
          <label for="density1">Плотность Т/Ж (г/см³)</label>
          <input type="number" step="0.1" id="density1" required value="1">
        </div>
        
        <div class="form-group compact">
          <label for="density2">Плотность ИЭР (г/см³)</label>
          <input type="number" step="0.1" id="density2" required value="1">
        </div>
        
        <div class="form-group compact">
          <label for="density3">Плотность БК (г/см³)</label>
          <input type="number" step="0.1" id="density3" required value="0">
        </div>
      </div>
      
      <div class="form-column">
        <h2>Дополнительные параметры</h2>
        
        <div class="form-group compact">
          <label for="well_type">Тип скважины</label>
          <select id="well_type" required>
            <option value="ВЕРТ" selected>ВЕРТ</option>
            <option value="ГОР">ГОР</option>
          </select>
        </div>
        
        <div class="form-group compact">
          <label for="cluster">Куст</label>
          <input type="number" id="cluster" value="0">
        </div>
        
        <div class="form-group compact">
          <label for="formation">Пласт</label>
          <select id="formation" required>
            <option value="PVII" selected>PVII</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
          </select>
        </div>
        
        <div class="form-group compact">
          <label for="se">Способ эксплуатации</label>
          <select id="se" required>
            <option value="Г/Л" selected>Г/Л</option>
            <option value="ФОН">ФОН</option>
            <option value="ЭЦН">ЭЦН</option>
          </select>
        </div>
      </div>
    </div>
    
    <button type="submit" class="submit-btn">Рассчитать</button>
  </form>
  
  <div id="result" class="result-container"></div>
</div>

<style>
  /* Стили остаются такими же, как в предыдущем варианте */
  :root {
    --primary-color: #2c3e50;
    --secondary-color: #3498db;
    --accent-color: #e74c3c;
    --light-gray: #ecf0f1;
    --dark-gray: #7f8c8d;
    --font-main: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }
  
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  body {
    font-family: var(--font-main);
    line-height: 1.6;
    color: #333;
    background-color: #f5f7fa;
    padding: 20px;
  }
  
  .gpn-container {
    max-width: 1200px;
    margin: 0 auto;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    padding: 30px;
  }
  
  .gpn-form {
    margin-bottom: 30px;
  }
  
  .form-columns {
    display: flex;
    gap: 30px;
    margin-bottom: 20px;
  }
  
  .form-column {
    flex: 1;
  }
  
  h2 {
    color: var(--primary-color);
    font-size: 1.4rem;
    margin-bottom: 15px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--light-gray);
  }
  
  .form-group {
    margin-bottom: 12px;
  }
  
  .form-group.compact {
    margin-bottom: 10px;
  }
  
  label {
    display: block;
    margin-bottom: 5px;
    font-size: 0.9rem;
    color: var(--primary-color);
    font-weight: 500;
  }
  
  input, select {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 0.95rem;
    transition: border 0.3s;
  }
  
  input:focus, select:focus {
    outline: none;
    border-color: var(--secondary-color);
    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
  }
  
  .submit-btn {
    background-color: var(--secondary-color);
    color: white;
    padding: 12px 24px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 500;
    transition: background 0.3s;
    display: block;
    width: 200px;
    margin: 20px auto 0;
  }
  
  .submit-btn:hover {
    background-color: #2980b9;
  }
  
  .result-container {
    margin-top: 30px;
    padding: 20px;
    background: var(--light-gray);
    border-radius: 8px;
  }
  
  .report-image {
    margin: 20px 0;
    text-align: center;
  }
  
  .report-image img {
    max-width: 100%;
    height: auto;
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  
  .report-text {
    background: white;
    padding: 20px;
    border-radius: 6px;
    margin-top: 20px;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    white-space: pre-wrap;
    overflow-x: auto;
  }
  
  .error {
    color: var(--accent-color);
    background: #fde8e8;
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 10px;
  }
  
  @media (max-width: 768px) {
    .form-columns {
      flex-direction: column;
      gap: 15px;
    }
    
    .submit-btn {
      width: 100%;
    }
  }
</style>

<script>
import { API_BASE_URL } from './config';
document.getElementById('gpnForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Собираем данные формы
    const test_kill = {
        'Номер скважины': document.getElementById('well_number').value,
        'Дата глушения': document.getElementById('kill_date').value,
        'Рпл (ат) (перед глушением)': parseFloat(document.getElementById('pressure').value),
        'Газовый факт м3/т': parseFloat(document.getElementById('gas_factor').value),
        'Глубина кровли пласта по вертикале (м)': parseFloat(document.getElementById('depth').value),
        'Расчетная плотность (г/см3)': parseFloat(document.getElementById('density').value),
        '1_ρ г/см3': parseFloat(document.getElementById('density1').value),
        '2_ρ г/см3': parseFloat(document.getElementById('density2').value),
        '3_ρ г/см3': parseFloat(document.getElementById('density3').value)
    };
    
    const additional_test_kill = {
        'Тип\nскважины': document.getElementById('well_type').value,
        'Куст': parseInt(document.getElementById('cluster').value),
        'Пласт': document.getElementById('formation').value,
        'СЭ': document.getElementById('se').value
    };
    
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '<div class="loading">Идет расчет...(1-2 минуты)</div>';
    console.log(API_BASE_URL);
    try {
        const response = await fetch(`${API_BASE_URL}/api/generate_report`, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                test_kill,
                additional_test_kill
            })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
            // Создаем контейнер для результатов
            resultDiv.innerHTML = `
                <h3>Результаты анализа для скважины ${data.well_number}</h3>
                <p class="report-meta">Дата глушения: ${data.kill_date}</p>
                <div class="report-image" id="imageContainer">
                    <div class="image-loading">Идет загрузка изображения...</div>
                </div>
                <div class="report-text">
                    <h4>Текстовый отчет:</h4>
                    <pre>${data.report}</pre>
                </div>
            `;
            
            // Загрузка изображения через URL
            const imageContainer = document.getElementById('imageContainer');
            const img = new Image();
            
            img.onload = function() {
                imageContainer.innerHTML = '';
                imageContainer.appendChild(img);
            };
            
            img.onerror = function() {
                imageContainer.innerHTML = '<div class="error">Ошибка загрузки изображения</div>';
            };
            
            img.src = data.image_url; // Используем URL вместо base64
            img.alt = "График анализа";
            img.style.maxWidth = '100%';
            img.style.height = 'auto';
            img.style.borderRadius = '6px';
            img.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
        }
        else {
            resultDiv.innerHTML = `
                <div class="error">Ошибка: ${data.message}</div>
                <p>Проверьте введенные данные и подключение к серверу</p>
            `;
        }
    } catch (error) {
        resultDiv.innerHTML = `
            <div class="error">Ошибка: ${error.message}</div>
            <p>Проверьте подключение к серверу</p>
        `;
    }
});
</script>